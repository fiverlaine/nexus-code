<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nexus Code Generator</title>
    <meta name="description" content="Gerador de c√≥digos seguros com design moderno" />
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚ö°</text></svg>" />
    
    <!-- Script 1: Criar _fbp cookie se n√£o existir E n√£o vier da URL -->
    <script>
      (function () {
        function getCookie(name) {
          return document.cookie
            .split("; ")
            .find((row) => row.startsWith(name + "="))
            ?.split("=")[1];
        }
        function setFbpCookie() {
          // Verificar se j√° existe cookie _fbp
          if (getCookie("_fbp")) {
            return;
          }
          
          // Verificar se fbp veio da URL (do insta1)
          try {
            var urlParams = new URLSearchParams(window.location.search);
            var fbpFromUrl = urlParams.get('fbp');
            if (fbpFromUrl) {
              // Se fbp veio da URL, usar esse valor para criar o cookie
              // Isso garante match entre eventos mesmo quando n√£o est√° em iframe
              var expires = new Date(Date.now() + 90 * 24 * 60 * 60 * 1000).toUTCString();
              var domain = location.hostname.replace(/^www\./, "");
              document.cookie = "_fbp=" + fbpFromUrl
                + "; path=/"
                + "; domain=" + domain
                + "; expires=" + expires
                + "; samesite=lax";
              console.log('‚úÖ FBP da URL usado para criar cookie:', fbpFromUrl);
              return;
            }
          } catch (e) {
            console.warn('Erro ao verificar fbp na URL:', e);
          }
          
          // Se n√£o veio da URL, criar um novo fbp apenas se necess√°rio
          var fbp = "fb.1." + Date.now() + "." + Math.floor(Math.random() * 1e10);
          var expires = new Date(Date.now() + 90 * 24 * 60 * 60 * 1000).toUTCString();
          var domain = location.hostname.replace(/^www\./, "");
          document.cookie = "_fbp=" + fbp
            + "; path=/"
            + "; domain=" + domain
            + "; expires=" + expires
            + "; samesite=lax";
        }
        setFbpCookie();
      })();
    </script>
    
    <!-- Meta Pixel Code -->
    <!-- IMPORTANTE: Mesmo Pixel ID do projeto insta1 para garantir match entre eventos -->
    <script>
      (function() {
        // Verificar se o pixel j√° est√° carregado (pode vir do parent em iframe)
        if (typeof window.fbq === 'function') {
          console.log('‚úÖ Facebook Pixel j√° est√° carregado (provavelmente do parent)');
          // Se j√° estiver carregado, apenas rastrear PageView se necess√°rio
          // O PageView j√° pode ter sido rastreado pelo parent
          return;
        }

        // Se n√£o estiver carregado, inicializar o pixel
        !function(f,b,e,v,n,t,s)
        {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)}(window, document,'script',
        'https://connect.facebook.net/en_US/fbevents.js');
        
        // Inicializar com o mesmo Pixel ID do projeto insta1
        fbq('init', '25009624982012198');
        
        // Rastrear PageView apenas se n√£o estiver em iframe (para evitar duplica√ß√£o)
        // Se estiver em iframe, o PageView j√° foi rastreado pelo parent
        var isInIframe = window.self !== window.top;
        if (!isInIframe) {
          fbq('track', 'PageView');
        } else {
          console.log('‚ÑπÔ∏è Detectado iframe - PageView j√° deve ter sido rastreado pelo parent');
        }
      })();
    </script>
    <!-- End Meta Pixel Code -->
    
    <!-- Script para solicitar fbp do parent quando estiver em iframe -->
    <script>
      (function() {
        // Verificar se est√° em iframe
        var isInIframe = window.self !== window.top;
        
        if (isInIframe) {
          // Armazenar fbp recebido do parent
          var parentFbp = null;
          
          // Listener para receber resposta do parent
          window.addEventListener('message', function(event) {
            if (event.data && event.data.type === 'FBP_RESPONSE' && event.data.fbp) {
              parentFbp = event.data.fbp;
              
              // Salvar no sessionStorage para uso posterior
              try {
                sessionStorage.setItem('parent_fbp', parentFbp);
                console.log('‚úÖ FBP do parent salvo:', parentFbp);
              } catch (e) {
                console.warn('Erro ao salvar fbp no sessionStorage:', e);
              }
            }
          });
          
          // Solicitar fbp do parent ao carregar
          try {
            window.parent.postMessage({
              type: 'REQUEST_FBP'
            }, '*');
            console.log('üì§ Solicita√ß√£o de FBP enviada ao parent');
          } catch (e) {
            console.warn('‚ö†Ô∏è Erro ao solicitar fbp do parent:', e);
          }
        }
      })();
    </script>
  </head>
  <body>
    <!-- Meta Pixel Noscript Fallback -->
    <noscript><img height="1" width="1" style="display:none"
      src="https://www.facebook.com/tr?id=25009624982012198&ev=PageView&noscript=1"
    /></noscript>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html> 